<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TUV Training record</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f7fa;
        color: #333;
    }
    .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 10px;
    }

    /* MINOR CHANGE: Bigger, Bold, Blue Header */
    h1 {
        text-align: center;
        color: #1e3a8a; 
        font-size: 42px; /* Increased size */
        font-weight: 900; /* Extra Bold */
    }

    .search-box {
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
        position: relative;
    }
    input[type="text"] {
        width: 100%;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 10px;
        border: 1px solid #ccc;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .suggestions {
        position: absolute;
        background: #fff;
        border: 1px solid #ccc;
        border-top: none;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        border-radius: 0 0 10px 10px;
        z-index: 10;
    }
    .suggestions div {
        padding: 10px;
        cursor: pointer;
    }
    .suggestions div:hover {
        background: #f0f0f0;
    }

    /* Cards - SAME LOOK */
    .dashboard {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
        justify-content: center;
    }
    .card {
        background: #fff;
        padding: 20px;
        width: 250px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        text-align: center;
        position: relative;
    }
    .card h3 {
        margin-bottom: 10px;
        color: #1e3a8a;
        font-size: 18px;
    }
    .card p {
        font-size: 16px;
        font-weight: bold;
    }
    .status-icon {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
    }

    /* PAGE 2 Table - MINOR CHANGE: Fit to Size */
    #page2 {
        width: 100%;
        overflow-x: auto; /* Ensures it fits the screen width */
    }
    #page2 table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        table-layout: auto; /* Content determines width */
    }
    #page2 th, #page2 td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
        font-size: 13px; /* Slightly smaller to fit better */
    }
    #page2 th {
        background: #1e3a8a;
        color: #fff;
    }

    .nav-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }
    button {
        padding: 10px 20px;
        border: none;
        background: #1e3a8a;
        color: #fff;
        font-weight: bold;
        border-radius: 10px;
        cursor: pointer;
    }
    button:hover {
        background: #3b5fd1;
    }
</style>
</head>
<body>

<div class="container">
    <h1>SCAFFOLDING TUV TRAINING RECORD</h1>
    <div class="nav-buttons">
        <button onclick="showPage(1)">Employee Details</button>
        <button onclick="showPage(2)">Full Data</button>
    </div>

    <div id="page1">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search Employee Name or ID">
            <div class="suggestions" id="suggestions"></div>
        </div>
        <div class="dashboard" id="dashboardCards">
            </div>
    </div>

    <div id="page2" style="display:none;">
        <table id="fullDataTable">
            <thead>
                <tr id="tableHead"></tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
const excelUrl = 'https://raw.githubusercontent.com/YourUsername/YourRepo/main/TUV_Training.xlsx'; 
let data = [];
let combinedSearch = [];

fetch(excelUrl)
    .then(res => res.arrayBuffer())
    .then(ab => {
        const workbook = XLSX.read(ab, {type: "array"});
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        data = XLSX.utils.sheet_to_json(sheet, {defval: ''});
        prepareSearch();
        populateFullTable();
    });

function prepareSearch() {
    combinedSearch = data.map((row, index) => ({
        display: `${row['B']} - ${row['C']}`,
        index: index
    }));
}

const searchInput = document.getElementById('searchInput');
const suggestions = document.getElementById('suggestions');
searchInput.addEventListener('input', () => {
    const val = searchInput.value.toLowerCase();
    suggestions.innerHTML = '';
    if(val) {
        const matches = combinedSearch.filter(item => item.display.toLowerCase().includes(val));
        matches.slice(0,10).forEach(item => {
            const div = document.createElement('div');
            div.textContent = item.display;
            div.onclick = () => selectSuggestion(item.index);
            suggestions.appendChild(div);
        });
    }
});

function selectSuggestion(idx) {
    searchInput.value = combinedSearch[idx].display;
    suggestions.innerHTML = '';
    populateCards(data[idx]);
}

function populateCards(row) {
    const dashboard = document.getElementById('dashboardCards');
    dashboard.innerHTML = '';

    const today = new Date();
    const expiry = new Date(row['G']);
    const remainingDays = Math.ceil((expiry - today)/(1000*60*60*24));

    let status = '';
    let color = '';
    if(remainingDays < 0){ status = 'Expired'; color='red';}
    else if(remainingDays <=30){ status='Expiring Soon'; color='orange';}
    else {status='Valid'; color='green';}

    const fields = [
        {title:'POSITION', value: row['D']},
        {title:'TYPE', value: row['E']},
        {title:'ISSUE DATE', value: row['F']},
        {title:'EXPIRY DATE', value: row['G']},
        {title:'Remaining Days', value: remainingDays},
        {title:'Status', value: `<span class="status-icon" style="background:${color}"></span>${status}`},
        {title:'Institute Name', value: row['H']},
        {title:'Requested for Renewal Date', value: row['I']},
        {title:'Certificate', value: row['J']},
        {title:'EMP STATUS', value: row['K']},
        {title:'REMARKS', value: row['L']},
        {title:'Physical Copy Received', value: row['M']}
    ];

    fields.forEach(f => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<h3>${f.title}</h3><p>${f.value}</p>`;
        dashboard.appendChild(card);
    });
}

function populateFullTable() {
    if(!data.length) return;
    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';

    Object.keys(data[0]).forEach(k => {
        const th = document.createElement('th');
        th.textContent = k;
        tableHead.appendChild(th);
    });

    data.forEach(row => {
        const tr = document.createElement('tr');
        Object.keys(row).forEach(k => {
            const td = document.createElement('td');
            td.textContent = row[k];
            tr.appendChild(td);
        });
        tableBody.appendChild(tr);
    });
}

function showPage(num){
    document.getElementById('page1').style.display = (num===1)?'block':'none';
    document.getElementById('page2').style.display = (num===2)?'block':'none';
}
</script>
</body>
</html>
