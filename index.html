<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TUV Training Dashboard</title>
<!-- Include SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
    body { font-family: 'Segoe UI', sans-serif; background:#f5f7fa; margin:0; padding:20px;}
    h1 { text-align:center; color:#1e3a8a; margin-bottom:20px; }
    .search-box { width:100%; max-width:400px; margin:0 auto 20px; position:relative; }
    input[type=text] { width:100%; padding:10px 15px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
    .suggestions { position:absolute; top:45px; width:100%; background:#fff; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.1); max-height:200px; overflow-y:auto; z-index:10;}
    .suggestions div { padding:8px 12px; cursor:pointer; }
    .suggestions div:hover { background:#1e3a8a; color:#fff; }
    .dashboard { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:20px; margin-top:20px; }
    .card { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center; }
    .card h3 { margin:0 0 10px; color:#1e3a8a; font-size:16px; font-weight:bold; }
    .card p { margin:0; font-size:18px; font-weight:bold; }
    .status { display:flex; align-items:center; justify-content:center; gap:8px; font-weight:bold; }
    .status span { width:12px; height:12px; border-radius:50%; display:inline-block; }
    .valid { background:green; }
    .expiring { background:orange; }
    .expired { background:red; }
    button { margin:10px 0; padding:8px 15px; border:none; border-radius:8px; background:#1e3a8a; color:#fff; cursor:pointer; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:8px 12px; text-align:center; }
    th { background:#1e3a8a; color:#fff; }
</style>
</head>
<body>

<h1>TUV Training Dashboard</h1>

<!-- Search -->
<div class="search-box">
    <input type="text" id="search" placeholder="Search Employee (Column B + C)">
    <div class="suggestions" id="suggestions"></div>
</div>

<!-- Dashboard Cards -->
<div class="dashboard" id="dashboard">
    <!-- Cards will be dynamically inserted here -->
</div>

<!-- Button to show Page 2 -->
<div style="text-align:center">
    <button onclick="showAllData()">Show All Data (Page 2)</button>
</div>

<!-- Page 2 Table -->
<div id="page2" style="display:none;">
    <table id="allData">
        <thead>
            <tr>
                <th>Position</th><th>Type</th><th>Issue Date</th><th>Expiry Date</th><th>Remaining Days</th>
                <th>Status</th><th>Institute Name</th><th>Requested Renewal</th><th>Certificate</th>
                <th>Emp Status</th><th>Remarks</th><th>Physical Copy</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
// --- Load Excel from GitHub ---
const excelUrl = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/TUV_Training.xlsx"; // Replace with your GitHub raw Excel URL
let workbookData = [];

fetch(excelUrl)
.then(res => res.arrayBuffer())
.then(data => {
    const workbook = XLSX.read(data, {type:"array"});
    const sheetName = workbook.SheetNames[0]; // Active sheet
    const sheet = workbook.Sheets[sheetName];
    workbookData = XLSX.utils.sheet_to_json(sheet, {defval:""});
    console.log("Loaded data:", workbookData);
});

// --- Search & Suggestions ---
const searchInput = document.getElementById("search");
const suggestionsDiv = document.getElementById("suggestions");
const dashboardDiv = document.getElementById("dashboard");

searchInput.addEventListener("input", function() {
    const query = this.value.toLowerCase();
    suggestionsDiv.innerHTML = "";
    if(query.length === 0) return;
    const matches = workbookData.filter(row => 
        ((row["Column B"] || "").toString() + " " + (row["Column C"] || "").toString()).toLowerCase().includes(query)
    );
    matches.slice(0,10).forEach(row => {
        const div = document.createElement("div");
        div.textContent = (row["Column B"] || "") + " " + (row["Column C"] || "");
        div.addEventListener("click", () => selectEmployee(row));
        suggestionsDiv.appendChild(div);
    });
});

// --- Select Employee ---
function selectEmployee(row) {
    suggestionsDiv.innerHTML = "";
    searchInput.value = (row["Column B"] || "") + " " + (row["Column C"] || "");
    dashboardDiv.innerHTML = "";
    
    const fields = [
        {name:"POSITION", value: row["Column D"]},
        {name:"TYPE", value: row["Column E"]},
        {name:"ISSUE DATE", value: row["Column F"]},
        {name:"EXPIRY DATE", value: row["Column G"]},
        {name:"Remaining Days", value: calculateRemainingDays(row["Column G"])},
        {name:"Status", value: calculateStatus(row["Column G"])},
        {name:"Institute Name", value: row["Column H"]},
        {name:"Requested Renewal", value: row["Column I"]},
        {name:"Certificate", value: row["Column J"]},
        {name:"EMP STATUS", value: row["Column K"]},
        {name:"Remarks", value: row["Column L"]},
        {name:"Physical Copy", value: row["Column M"]}
    ];

    fields.forEach(f => {
        const card = document.createElement("div");
        card.className = "card";
        const h3 = document.createElement("h3");
        h3.textContent = f.name;
        const p = document.createElement("p");
        if(f.name === "Status") {
            const span = document.createElement("span");
            span.className = f.value === "Valid" ? "valid" : f.value === "Expiring Soon" ? "expiring" : "expired";
            const statusDiv = document.createElement("div");
            statusDiv.className = "status";
            statusDiv.appendChild(span);
            statusDiv.appendChild(document.createTextNode(f.value));
            card.appendChild(h3);
            card.appendChild(statusDiv);
        } else {
            p.textContent = f.value;
            card.appendChild(h3);
            card.appendChild(p);
        }
        dashboardDiv.appendChild(card);
    });
}

// --- Remaining Days & Status ---
function calculateRemainingDays(expiryDate) {
    if(!expiryDate) return "-";
    const today = new Date();
    const exp = new Date(expiryDate);
    const diff = Math.ceil((exp - today) / (1000*60*60*24));
    return diff;
}

function calculateStatus(expiryDate) {
    const days = calculateRemainingDays(expiryDate);
    if(days < 0) return "Expired";
    else if(days <=30) return "Expiring Soon";
    else return "Valid";
}

// --- Page 2 Table ---
function showAllData() {
    document.getElementById("page2").style.display = "block";
    const tbody = document.querySelector("#allData tbody");
    tbody.innerHTML = "";
    workbookData.forEach(row => {
        const tr = document.createElement("tr");
        const remaining = calculateRemainingDays(row["Column G"]);
        const status = calculateStatus(row["Column G"]);
        const values = [
            row["Column D"], row["Column E"], row["Column F"], row["Column G"], remaining,
            status, row["Column H"], row["Column I"], row["Column J"], row["Column K"], row["Column L"], row["Column M"]
        ];
        values.forEach(v => { const td = document.createElement("td"); td.textContent = v; tr.appendChild(td); });
        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
